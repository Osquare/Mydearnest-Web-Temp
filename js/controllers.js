function GetURLParameter(e){for(var t=window.location.search.substring(1),a=t.split("&"),n=0;n<a.length;n++){var i=a[n].split("=");if(i[0]==e)return i[1]}}ResizeWindow=function(){var e=Math.floor($(window).width()/2)-1;$(window).width()<1024?($(".magazineItem:nth-child(1)").width($(window).width()),$(".magazineItem").slice(1).width(e)):($(".magazineItem:nth-child(2)").width($(window).width()),$(".magazineItem").slice(2).width(e)),$(".magazineItem").height(e)},PinClick=function(){var e=$(this).parent().find(".pinProductTitle").text(),t=$(this).parent().find(".pinProductPrice").text(),a=$(this).parent().find(".pinProductButton").attr("href"),n=$(this).parent().find(".pinProductImage").attr("src");return $("#ProductPopupTitle").text(e),$("#ProductPopupPrice").text(t),$("#ProductPopupButton").attr("href",a),$("#ProductPopupImage").attr("src",n),$("#ProductPopup").width("initial"),$("#ProductPopup").imagesLoaded(function(){$("#ProductPopupOverlayWrapper").addClass("active");var e=$("#ProductPopupOverlayWrapper").height()-$("#ProductPopup").height();if(100>e){var t=$("#ProductPopup").height()/$("#ProductPopup").width(),a=($("#ProductPopupOverlayWrapper").height()-60)/t;$("#ProductPopup").width(a+"px"),e=$("#ProductPopupOverlayWrapper").height()-$("#ProductPopup").height()}$("#ProductPopupWrapper").css("top",e/2+"px")}),!1},escapeHTML=function(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace(/\n/gi,"<br>")},$(document).ready(function(){$(window).resize(ResizeWindow),$("#ProductPopupExit,#ProductPopupOverlay").click(function(){$("#ProductPopupOverlayWrapper").removeClass("active")})});var homedecoApp=angular.module("homedecoApp",["ngSanitize","infinite-scroll"]),API_URL="http://mydearnestapi-env.elasticbeanstalk.com/open_api/magazines",IMAGE_URL="http://image.ggumim.co.kr/unsafe/{id}/{id}",PageCount_URL="http://mydearnestapi-env.elasticbeanstalk.com/api/count/";homedecoApp.controller("MagazineListController",["$scope","$http","$timeout",function(e,t,a){if(e.magazines=[],e.scroll_busy=!0,e.last_id=null,e.intentID=GetURLParameter("id"),/Android/i.test(navigator.userAgent)){var n="mydearnest://move?position=0#Intent;scheme=mydearnest;package=com.osquare.mydearnest;end";angular.element(".HeaderAppLink").attr("href",n)}else if(/iPhone/i.test(navigator.userAgent)){var n="mydearnest://view?msgType=12&id="+e.intentID+"&postType=0";angular.element(".HeaderAppLink").click(function(e){e.preventDefault(),a(function(){var e=angular.element("<iframe></iframe>");e.attr("src",n),e.appendTo("body"),a(function(){location.href="https://itunes.apple.com/kr/app/jibkkumigi/id992731402?mt=8"},500)},500)})}t.put(PageCount_URL+"guest"),addMagazines=function(t){for(var n=0;n<t.data.length;n++){var i={id:t.data[n]._id,image_url:IMAGE_URL.replace(/{id}/gi,t.data[n].contents.title.image),text:escapeHTML(t.data[n].contents.title.text)};e.last_id=i.id,e.magazines.push(i)}t.data.length&&(e.scroll_busy=!1),a(ResizeWindow,0)},e.loadMore=function(){if(!e.scroll_busy){e.scroll_busy=!0;var a=API_URL+"?limit=10";e.last_id&&(a+="&current="+e.last_id),t.get(a).success(addMagazines)}},t.get(API_URL).success(addMagazines)}]),homedecoApp.controller("MagazineController",["$scope","$http","$timeout","$location",function(e,t,a){if(e.title="",e.content="",e.pages=[],e.intentID=GetURLParameter("id"),/Android/i.test(navigator.userAgent)){var n="mydearnest://move?position=0#Intent;scheme=mydearnest;package=com.osquare.mydearnest;end";angular.element(".HeaderAppLink").attr("href",n)}else if(/iPhone/i.test(navigator.userAgent)){var n="mydearnest://view?msgType=12&id="+e.intentID+"&postType=0";angular.element(".HeaderAppLink").click(function(e){e.preventDefault(),a(function(){var e=angular.element("<iframe></iframe>");e.attr("src",n),e.appendTo("body"),a(function(){location.href="https://itunes.apple.com/kr/app/jibkkumigi/id992731402?mt=8"},500)},500)})}angular.element("#HeaderAppLink").width($(window).width()).height($(window).width()/2),t.put(PageCount_URL+"page"),pinClickSetting=function(){$(".imagePinMobileLink").click(PinClick),$(".imagePinWrapper").hover(function(){var e=$(this).find(".pinProductImage").width()+$(this).find(".pinProductContent").width()+34;$(this).find(".pinProductWrapper").width(e)})},init=function(t){e.title=escapeHTML(t.data.contents.title.text),e.pages=angular.copy(t.data.contents.pages);for(var n=0;n<t.data.contents.pages.length;n++){e.pages[n].pins=[];for(var i=0;i<t.data.contents.pages[n].pins.length;i++)!t.data.contents.pages[n].pins[i].correct&&angular.isArray(t.data.contents.pages[n].pins[i].similars)&&t.data.contents.pages[n].pins[i].similars.length>0&&(t.data.contents.pages[n].pins[i].correct=t.data.contents.pages[n].pins[i].similars[0]),t.data.contents.pages[n].pins[i].correct&&(t.data.contents.pages[n].pins[i].correct.contents.image&&0!==t.data.contents.pages[n].pins[i].correct.contents.image.indexOf("http")&&(t.data.contents.pages[n].pins[i].correct.contents.image=IMAGE_URL.replace(/{id}/gi,t.data.contents.pages[n].pins[i].correct.contents.image)),e.pages[n].pins.push({offset:t.data.contents.pages[n].pins[i].offset,contents:t.data.contents.pages[n].pins[i].correct.contents}))}a(pinClickSetting,0)},e.bindText=function(e){return e?escapeHTML(e):void 0},t.get(API_URL+"/"+GetURLParameter("id")).success(init)}]),homedecoApp.directive("applink",["$timeout","$window",function(e){return{restrict:"E",template:'<iframe style="display:none;"></iframe>',link:function(t,a){if(GetURLParameter("isShare")){var n=GetURLParameter("id"),i=new Date,r=navigator.userAgent.toLocaleLowerCase(),o=r.search("android")>-1,s=r.search("iphone")>-1,p=a.find("iframe"),c=!1,d=!1,u="mydearnest://view?msgType=12&postType=0",m="mydearnest://view?msgType=12&id="+n+"&postType=0",l="mydearnest://move?position=0#Intent;scheme=mydearnest;package=com.osquare.mydearnest;end",g="intent://view?msgType=12&id="+n+"&postType=0/#Intent;scheme=mydearnest;package=com.osquare.mydearnest;end";e(function(){new Date-i<4e3&&o&&p.attr("src","market://details?id=com.osquare.mydearnest")},3e3),o?(c=r.search("chrome")>-1&&navigator.appVersion.match(/Chrome\/\d+.\d+/)[0].split("/")[1]>25,d=-1!==r.indexOf("naver")||-1!==r.indexOf("daum"),c?document.location.href=n?g:l:p.attr("src","mydearnest://move?position=0#Intent;scheme=mydearnest;package=com.osquare.mydearnest;end")):s&&(n?p.attr("src",m):p.attr("src",u))}}}}]);